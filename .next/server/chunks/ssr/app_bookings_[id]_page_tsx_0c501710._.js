module.exports=[18552,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(72211),f=a.i(13216),g=a.i(40695),h=a.i(3130),i=a.i(54161),j=a.i(96221),k=a.i(41675),l=a.i(24987),m=a.i(41710),n=a.i(90166),o=a.i(24569),p=a.i(81560),q=a.i(210),r=a.i(16201),s=a.i(62722),t=a.i(11156),u=a.i(92e3),v=a.i(38246),w=a.i(71987);function x(){let a=(0,d.useParams)(),x=(0,d.useRouter)(),{user:y,isAuthenticated:z}=(0,f.useAuth)(),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)({checkInDate:"",checkOutDate:"",numberOfGuests:1,requestedPrice:""}),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(null),S=a.id;(0,c.useEffect)(()=>{S&&T()},[S]),(0,c.useEffect)(()=>{A?.propertyId&&(U(),V())},[A?.propertyId]),(0,c.useEffect)(()=>{K&&M.checkInDate&&M.checkOutDate&&Q?.pricePerNight&&W()},[K,M.checkInDate,M.checkOutDate,Q]);let T=async()=>{try{F(!0),H("");let a=await e.apiClient.bookings.getById(S);B(a),N({checkInDate:a.checkInDate||"",checkOutDate:a.checkOutDate||"",numberOfGuests:1,requestedPrice:a.requestedNegotiationPercent?"":a.totalPrice?.toString()||""})}catch(a){console.error("Failed to fetch booking:",a),H(a.message||"Failed to load booking details")}finally{F(!1)}},U=async()=>{if(A?.propertyId)try{let a=await e.apiClient.properties.getById(String(A.propertyId));D(a)}catch(a){console.error("Failed to fetch property:",a)}},V=async()=>{if(A?.propertyId)try{let a=await e.apiClient.bookings.getPropertyInfo(String(A.propertyId));R(a)}catch(a){console.error("Failed to fetch property info:",a)}},W=()=>{if(M.checkInDate&&M.checkOutDate&&Q?.pricePerNight)try{let a=new Date(M.checkInDate),b=new Date(M.checkOutDate),c=Math.ceil((b.getTime()-a.getTime())/864e5),d=Number(Q.pricePerNight)*c;P(d)}catch(a){console.error("Error calculating base price:",a)}},X=async()=>{if(!A)return;if(!M.checkInDate||!M.checkOutDate)return void H("Please fill in all required fields");let a=new Date(M.checkInDate),b=new Date(M.checkOutDate),c=new Date;if(c.setHours(0,0,0,0),a<c)return void H("Check-in date must be today or later");if(b<=a)return void H("Check-out date must be after check-in date");J(!0),H("");try{let a={checkInDate:M.checkInDate,checkOutDate:M.checkOutDate,numberOfGuests:M.numberOfGuests};M.requestedPrice&&(a.requestedPrice=parseFloat(M.requestedPrice));let b=await e.apiClient.bookings.update(A.id,a);!1===b.hasNegotiation&&a.requestedPrice&&O?setTimeout(()=>{x.push(`/payment?bookingId=${A.id}`)},1e3):(await T(),L(!1))}catch(a){H(a.message||"Failed to update booking")}finally{J(!1)}},Y=async()=>{if(A&&window.confirm("Are you sure you want to cancel this booking? This action cannot be undone.")){J(!0),H("");try{await e.apiClient.bookings.delete(A.id),x.push("/my-bookings")}catch(a){H(a.message||"Failed to cancel booking"),J(!1)}}},Z=a=>{if(!a)return"N/A";try{return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return a}};if(E)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(j.Loader2,{className:"h-12 w-12 animate-spin text-teal-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading booking details..."})]})});if(G&&!A)return(0,b.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:(0,b.jsxs)(h.Card,{className:"p-8 text-center max-w-md",children:[(0,b.jsx)(u.AlertCircle,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:G}),(0,b.jsx)(v.default,{href:"/my-bookings",children:(0,b.jsx)(g.Button,{variant:"outline",children:"Back to Bookings"})})]})});if(!A)return(0,b.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:(0,b.jsxs)(h.Card,{className:"p-8 text-center max-w-md",children:[(0,b.jsx)(s.XCircle,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Booking Not Found"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"The booking you're looking for doesn't exist."}),(0,b.jsx)(v.default,{href:"/my-bookings",children:(0,b.jsx)(g.Button,{variant:"outline",children:"Back to Bookings"})})]})});let $=((a,b)=>{if(!a||!b)return 0;try{let c=new Date(a),d=new Date(b),e=Math.abs(d.getTime()-c.getTime());return Math.ceil(e/864e5)}catch{return 0}})(A.checkInDate,A.checkOutDate),_=(a=>{if(!a?.propertyImages||0===a.propertyImages.length)return null;let b=a.propertyImages.find(a=>a.cover);return b?b.url:a.propertyImages[0].url})(C);return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50",children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,b.jsx)(v.default,{href:"/my-bookings",children:(0,b.jsxs)(g.Button,{variant:"ghost",className:"mb-6",children:[(0,b.jsx)(q.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Bookings"]})}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Booking #",A.id]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(a=>{switch(a.toUpperCase()){case"PENDING_PAYMENT":return(0,b.jsx)(i.Badge,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Awaiting Payment"});case"PENDING_NEGOTIATION":case"PENDING":return(0,b.jsx)(i.Badge,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Pending"});case"CONFIRMED":return(0,b.jsx)(i.Badge,{className:"bg-green-100 text-green-800 border-green-200",children:"Confirmed"});case"COMPLETED":return(0,b.jsx)(i.Badge,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Completed"});case"TENANT_CHECKED_OUT":return(0,b.jsx)(i.Badge,{className:"bg-purple-100 text-purple-800 border-purple-200",children:"Checked Out"});case"CANCELLED":return(0,b.jsx)(i.Badge,{className:"bg-red-100 text-red-800 border-red-200",children:"Cancelled"});default:return(0,b.jsx)(i.Badge,{className:"bg-gray-100 text-gray-800 border-gray-200",children:a})}})(A.status),A.onChainTxHash&&(0,b.jsxs)(i.Badge,{variant:"outline",className:"text-xs",children:["Transaction: ",A.onChainTxHash.substring(0,10),"..."]})]})]}),G&&(0,b.jsx)(h.Card,{className:"p-4 mb-6 border-red-200 bg-red-50",children:(0,b.jsx)("p",{className:"text-red-700 text-sm",children:G})}),C&&_&&(0,b.jsxs)(h.Card,{className:"mb-6 overflow-hidden",children:[(0,b.jsx)("div",{className:"relative h-64 bg-gradient-to-br from-teal-100 to-teal-200",children:(0,b.jsx)(w.default,{src:_?_.startsWith("http://")||_.startsWith("https://")?_:_.startsWith("/uploads")?`http://localhost:8081${_}`:_:"/placeholder.jpg",alt:C.title||"Property",fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 80vw"})}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:C.title}),C.address&&(0,b.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,b.jsx)(l.MapPin,{className:"w-4 h-4 mr-2 text-teal-600"}),(0,b.jsxs)("span",{children:[C.address.city,", ",C.address.country]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2 space-y-6",children:K?(0,b.jsxs)(h.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Edit Booking"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check-in Date *"}),(0,b.jsx)("input",{type:"date",value:M.checkInDate,onChange:a=>N({...M,checkInDate:a.target.value}),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check-out Date *"}),(0,b.jsx)("input",{type:"date",value:M.checkOutDate,onChange:a=>N({...M,checkOutDate:a.target.value}),min:M.checkInDate||new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-600"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Guests"}),(0,b.jsx)("input",{type:"number",min:"1",value:M.numberOfGuests,onChange:a=>N({...M,numberOfGuests:parseInt(a.target.value)||1}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-600"})]}),O&&(0,b.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,b.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,b.jsx)("strong",{children:"Base Price:"})," ",O.toFixed(4)," ETH"]}),Q?.negotiationPercentage&&Q.negotiationPercentage>0&&(0,b.jsxs)("p",{className:"text-sm text-blue-800 mt-1",children:[(0,b.jsx)("strong",{children:"Min Negotiation:"})," ",(O*(1-Q.negotiationPercentage/100)).toFixed(4)," ETH"]})]}),Q?.negotiationPercentage&&Q.negotiationPercentage>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Requested Price (ETH) - Leave empty for full price"}),(0,b.jsx)("input",{type:"number",step:"0.001",min:O?(O*(1-Q.negotiationPercentage/100)).toFixed(4):0,max:O?.toFixed(4),value:M.requestedPrice,onChange:a=>N({...M,requestedPrice:a.target.value}),placeholder:O?`Enter price (min: ${(O*(1-Q.negotiationPercentage/100)).toFixed(4)} ETH)`:"",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-600"}),O&&M.requestedPrice&&(0,b.jsx)("p",{className:"text-xs mt-1 text-gray-600",children:parseFloat(M.requestedPrice)>=O?"✅ Full price - negotiation will be cancelled":parseFloat(M.requestedPrice)>=O*(1-Q.negotiationPercentage/100)?"✅ Valid negotiation price":"⚠️ Price below minimum allowed"})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)(g.Button,{onClick:X,disabled:I,className:"flex-1 bg-teal-600 hover:bg-teal-700 text-white",children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"}),(0,b.jsx)(g.Button,{onClick:()=>{L(!1),A&&N({checkInDate:A.checkInDate||"",checkOutDate:A.checkOutDate||"",numberOfGuests:1,requestedPrice:A.requestedNegotiationPercent?"":A.totalPrice?.toString()||""})},disabled:I,variant:"outline",className:"flex-1",children:"Cancel"})]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(h.Card,{className:"p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(k.Calendar,{className:"w-5 h-5 mr-2 text-teal-600"}),"Booking Dates"]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Check-in Date"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:Z(A.checkInDate)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Check-out Date"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:Z(A.checkOutDate)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-600 flex items-center",children:[(0,b.jsx)(m.Clock,{className:"w-4 h-4 mr-2 text-teal-600"}),"Duration"]}),(0,b.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[$," ",1===$?"night":"nights"]})]})]})]}),(0,b.jsxs)(h.Card,{className:"p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(n.DollarSign,{className:"w-5 h-5 mr-2 text-teal-600"}),"Pricing Details"]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Total Price"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-teal-600",children:[A.totalPrice?.toFixed(4)||"N/A"," ETH"]})]}),A.longStayDiscountPercent&&A.longStayDiscountPercent>0&&(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Long Stay Discount"}),(0,b.jsxs)("span",{className:"text-sm font-semibold text-blue-600",children:[A.longStayDiscountPercent,"%"]})]}),A.requestedNegotiationPercent&&A.requestedNegotiationPercent>0&&(0,b.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Negotiation"}),(0,b.jsxs)("span",{className:"text-sm font-semibold text-yellow-600",children:[A.requestedNegotiationPercent,"%"]})]})]})]}),(0,b.jsxs)(h.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Booking Information"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Booking ID"}),(0,b.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:["#",A.id]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Property ID"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:A.propertyId})]}),A.createdAt&&(0,b.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Created At"}),(0,b.jsx)("span",{className:"text-sm text-gray-900",children:Z(A.createdAt)})]})]})]})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[!K&&(0,b.jsxs)(h.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions"}),(0,b.jsxs)("div",{className:"space-y-3",children:[("PENDING"===A.status||"PENDING_PAYMENT"===A.status||"PENDING_NEGOTIATION"===A.status)&&(0,b.jsxs)(g.Button,{onClick:()=>{L(!0)},disabled:I,variant:"outline",className:"w-full",children:[(0,b.jsx)(o.Edit,{className:"w-4 h-4 mr-2"}),"Edit Booking"]}),("PENDING_PAYMENT"===A.status||"PENDING"===A.status&&!A.requestedNegotiationPercent)&&(0,b.jsxs)(g.Button,{onClick:()=>x.push(`/payment?bookingId=${A.id}`),className:"w-full bg-teal-600 hover:bg-teal-700 text-white",children:[(0,b.jsx)(t.CreditCard,{className:"w-4 h-4 mr-2"}),"Pay Now"]}),"CONFIRMED"===A.status&&(0,b.jsx)(g.Button,{onClick:async()=>{if(window.confirm("Are you sure you have checked out?")){J(!0);try{await e.apiClient.bookings.markAsCheckedOut(A.id,parseInt(y.id)),await T()}catch(a){H(a.message||"Failed to confirm checkout")}finally{J(!1)}}},disabled:I,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.CheckCircle,{className:"w-4 h-4 mr-2"}),"I've Checked Out"]})}),("PENDING"===A.status||"PENDING_PAYMENT"===A.status||"PENDING_NEGOTIATION"===A.status)&&(0,b.jsx)(g.Button,{onClick:Y,disabled:I,variant:"destructive",className:"w-full",children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Trash2,{className:"w-4 h-4 mr-2"}),"Cancel Booking"]})})]})]}),(0,b.jsxs)(h.Card,{className:"p-6 bg-teal-50 border-teal-200",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-teal-900 mb-3",children:"Quick Info"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-teal-700",children:"Status:"}),(0,b.jsx)("span",{className:"font-medium text-teal-900",children:A.status})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-teal-700",children:"Nights:"}),(0,b.jsx)("span",{className:"font-medium text-teal-900",children:$})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-teal-700",children:"Total:"}),(0,b.jsxs)("span",{className:"font-medium text-teal-900",children:[A.totalPrice?.toFixed(4)||"N/A"," ETH"]})]})]})]})]})]})]})})}a.s(["default",()=>x])}];

//# sourceMappingURL=app_bookings_%5Bid%5D_page_tsx_0c501710._.js.map