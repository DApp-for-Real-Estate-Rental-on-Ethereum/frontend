module.exports=[44451,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(72211),f=a.i(40695),g=a.i(3130),h=a.i(5522),i=a.i(17171),j=a.i(210);let k=(0,a.i(70106).default)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var l=a.i(96221),m=a.i(41675),n=a.i(46842),o=a.i(92e3),p=a.i(13216),q=a.i(23292);function r(){let a=(0,d.useSearchParams)(),r=(0,d.useRouter)(),{user:s}=(0,p.useAuth)(),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H]=(0,c.useState)(1e-4),[I,J]=(0,c.useState)("Not connected"),[K,L]=(0,c.useState)(!1);async function M(a){try{E(!0),A(null);let b=await e.apiClient.payments.getBookingDetails(a);if(!b.ownerWalletAddress||"null"===b.ownerWalletAddress||"N/A"===b.ownerWalletAddress||""===b.ownerWalletAddress)throw Error("Owner wallet address is missing");if(!b.totalPrice||b.totalPrice<=0)throw Error("Booking total price is missing or invalid");C(b),A(null)}catch(b){let a=b.message||"An unexpected error occurred";A(`Failed to load booking details: ${a}`)}finally{E(!1)}}async function N(){try{return void q.toast.error("MetaMask is not available. Please install it first.")}catch(a){q.toast.error(`Failed to connect wallet: ${a.message}`)}}async function O(a){try{return}catch(a){J("Error: "+(a.message||"Unknown error")),L(!1),G(null),q.toast.error(`Failed to check wallet balance: ${a.message||"Unknown error"}`)}}(0,c.useEffect)(()=>{let b=a.get("bookingId")||a.get("id");if(b){let a=parseInt(b,10);!isNaN(a)&&a>0?(u(a),M(a)):A("Invalid booking ID in URL. Please use a valid number.")}else A("Booking ID is required in URL. Please add ?bookingId=1 to the URL.")},[a]),(0,c.useEffect)(()=>{v||B?.userWalletAddress},[B?.userWalletAddress,v]),(0,c.useEffect)(()=>{},[v,B]);let P=(0,c.useMemo)(()=>(function(){if(!B||!t||!(v||B.userWalletAddress)||!B.ownerWalletAddress||"N/A"===B.ownerWalletAddress||!I||"Not connected"===I||!K)return!1;let a=B.totalPrice||0;return!!a&&!(a<=0)&&null!=H&&null!=F&&!(F<a+H)&&!1})(),[B,t,v,I,K,F,H]);async function Q(){if(!t)return void q.toast.error("Booking ID is required");if(!v&&!B?.userWalletAddress)return void q.toast.error("Please connect MetaMask first");try{y(!0);let a=await e.apiClient.payments.createIntent(t);await R(a)}catch(b){let a=b?.message||b?.toString()||"Unknown error";q.toast.error(`Failed to create payment intent: ${a}`),A(a)}finally{y(!1)}}async function R(a){try{return void q.toast.error("MetaMask is not installed. Please install MetaMask extension.")}catch(b){let a=b.message||"Failed to send transaction";if(4001===b.code)a="Transaction rejected by user. Please approve the transaction in MetaMask.";else if(-32603===b.code){let c=b.data||b.error||{},d=c.message||c.error||b.message||"Unknown error";a=d.includes("execution reverted")||d.includes("revert")?`Transaction reverted by contract. Possible reasons:
- Booking already exists
- Incorrect payment amount
- Invalid wallet address
- Contract validation failed

Details: ${d}`:d.includes("gas")||d.includes("out of gas")?`Gas estimation failed. This might be due to:
- Contract execution would fail
- Insufficient gas limit
- Contract validation error

Details: ${d}`:d.includes("insufficient funds")||d.includes("balance")?`Insufficient balance. Please add more ETH to your wallet.

Details: ${d}`:`Internal JSON-RPC error. This might be due to:
- Insufficient balance
- Invalid contract address
- Network mismatch
- Invalid transaction data
- Contract execution error

Details: ${d}`,console.error("❌ JSON-RPC Error Details:",{code:b.code,message:b.message,data:b.data,error:b.error,rpcError:d})}else"CALL_EXCEPTION"===b.code||b.reason?a=`Transaction failed: ${b.reason||b.message}`:b.message?.includes("insufficient funds")||b.message?.includes("insufficient balance")?a="Insufficient balance. Please add more ETH to your wallet.":b.message?.includes("network")||b.message?.includes("chain")?a="Network mismatch. Please switch to the correct network in MetaMask.":b.message?.includes("user rejected")||b.message?.includes("User denied")||b.message?.includes("rejected")?a="Transaction rejected by user. Please approve the transaction in MetaMask.":(b.message?.includes("connection")||b.message?.includes("connect"))&&(a="Failed to connect to MetaMask. Please make sure MetaMask is unlocked and try again.");throw q.toast.error(a),b}}if(z)return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:(0,b.jsxs)(g.Card,{className:"max-w-md w-full p-8 text-center shadow-xl",children:[(0,b.jsx)("div",{className:"flex justify-center mb-4",children:(0,b.jsx)(o.AlertCircle,{className:"w-16 h-16 text-red-500"})}),(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Failed to Load Booking Details"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:z}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"Please make sure the booking ID in the URL is correct and the booking exists in the database."}),(0,b.jsxs)(f.Button,{onClick:()=>r.push("/my-bookings"),variant:"outline",className:"w-full",children:[(0,b.jsx)(j.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to My Bookings"]})]})});if(null===t||D)return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(l.Loader2,{className:"w-12 h-12 animate-spin text-teal-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading booking details..."})]})});let S=B?.totalPrice||0,T=B?.checkInDate&&B?.checkOutDate?Math.ceil((new Date(B.checkOutDate).getTime()-new Date(B.checkInDate).getTime())/864e5):0,U=v||B?.userWalletAddress,V=U&&""!==U.trim()&&"null"!==U;return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8 px-4",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)(g.Card,{className:"p-8 shadow-xl",children:[(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>r.push("/my-bookings"),className:"mb-6 -ml-2",children:[(0,b.jsx)(j.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Confirm and pay"}),(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"1. Payment method"}),(0,b.jsxs)(g.Card,{className:"p-6 border-2 border-teal-600 bg-teal-50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)(k,{className:"w-6 h-6 text-teal-600"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:"Ethereum (MetaMask)"})]}),V?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"text-sm font-medium text-gray-700",children:"Currently Connected Wallet"}),(0,b.jsx)(h.Input,{value:U,readOnly:!0,className:`mt-1 font-mono text-sm ${B?.userWalletAddress&&U?.toLowerCase()!==B.userWalletAddress.toLowerCase()?B.ownerWalletAddress&&U?.toLowerCase()===B.ownerWalletAddress.toLowerCase()?"border-red-500 bg-red-50":"border-yellow-500 bg-yellow-50":"border-green-500 bg-green-50"}`}),B?.userWalletAddress&&U?.toLowerCase()===B.userWalletAddress.toLowerCase()&&(0,b.jsx)("p",{className:"text-xs text-green-700 mt-1",children:"✅ Correct tenant wallet connected"}),B?.ownerWalletAddress&&U?.toLowerCase()===B.ownerWalletAddress.toLowerCase()&&(0,b.jsx)("p",{className:"text-xs text-red-700 mt-1 font-semibold",children:"❌ ERROR: You are connected with the HOST's wallet! Please switch to the tenant wallet above."}),B?.userWalletAddress&&B?.ownerWalletAddress&&U?.toLowerCase()!==B.userWalletAddress.toLowerCase()&&U?.toLowerCase()!==B.ownerWalletAddress.toLowerCase()&&(0,b.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"⚠️ WARNING: This wallet doesn't match the required tenant wallet. Payment will be deducted from this wallet."}),(0,b.jsx)(f.Button,{onClick:async()=>{if(U){G(null);try{await O(U),q.toast.success("Wallet balance refreshed")}catch(a){q.toast.error(`Failed to refresh: ${a.message}`)}}else q.toast.error("No wallet address available. Please connect MetaMask first.")},variant:"ghost",size:"sm",className:"mt-2 text-xs",disabled:!U,children:"Refresh Balance"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"text-sm font-medium text-gray-700",children:"Network"}),(0,b.jsx)(h.Input,{value:I,readOnly:!0,className:"mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"text-sm font-medium text-gray-700",children:"Amount in ETH"}),(0,b.jsx)(h.Input,{value:S>0?`${S.toFixed(6)} ETH`:"0.000000 ETH",readOnly:!0,className:"mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"text-sm font-medium text-gray-700",children:"Your Wallet Balance"}),(0,b.jsx)(h.Input,{value:null!==F?`${F.toFixed(6)} ETH`:"Checking...",readOnly:!0,className:`mt-1 ${null!==F&&S>0&&F<S+H?"border-red-500":""}`}),null===F&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"⏳ Loading balance..."}),null!==F&&S>0&&(0,b.jsx)("p",{className:`text-xs mt-1 ${F>=S+H?"text-green-600":"text-red-600"}`,children:F>=S+H?"✓ Sufficient balance":`✗ Insufficient balance. You need ${(S+H).toFixed(6)} ETH`})]}),(0,b.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-2",children:"MetaMask Status:"}),(0,b.jsx)("p",{className:"text-sm text-yellow-700",children:"✗ MetaMask not installed"}),!1]})]}):(0,b.jsxs)(f.Button,{onClick:N,className:"w-full bg-teal-600 hover:bg-teal-700",children:[(0,b.jsx)(k,{className:"w-4 h-4 mr-2"}),"Connect MetaMask"]})]})]}),!P&&!x&&(0,b.jsx)(g.Card,{className:"p-6 bg-amber-50 border-amber-200",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(o.AlertCircle,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-amber-900 mb-2",children:"Please complete the following:"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm text-amber-800",children:[(!B||!t)&&(0,b.jsx)("li",{children:"• Booking details are missing"}),!v&&!B?.userWalletAddress&&(0,b.jsx)("li",{children:"• Connect your MetaMask wallet"}),(!B?.ownerWalletAddress||B?.ownerWalletAddress==="N/A")&&(0,b.jsx)("li",{children:"• Property owner wallet address is missing"}),(!I||"Not connected"===I)&&(0,b.jsx)("li",{children:"• Connect to a supported network"}),!K&&(0,b.jsx)("li",{children:"• Switch to Hardhat Local or Arbitrum One network"}),(!B?.totalPrice||B.totalPrice<=0)&&(0,b.jsx)("li",{children:"• Booking price is invalid"}),null==H&&(0,b.jsx)("li",{children:"• Gas estimate is being calculated"}),null==F&&(0,b.jsx)("li",{children:"• Wallet balance is being checked"}),null!=F&&B&&B.totalPrice>0&&F<B.totalPrice+H&&(0,b.jsxs)("li",{children:["• Insufficient balance. You need"," ",(B.totalPrice+H).toFixed(6)," ETH"]}),(0,b.jsx)("li",{children:"• MetaMask extension is not installed"})]})]})]})}),(0,b.jsx)(f.Button,{onClick:async a=>{if(a.preventDefault(),a.stopPropagation(),!x&&P)try{await Q()}catch(a){q.toast.error(`Error: ${a?.message||a?.toString()||"Unknown error"}`)}else if(x)q.toast.info("Please wait, processing...");else{let a=[];B&&t||a.push("Booking details missing"),v||B?.userWalletAddress||a.push("Wallet not connected"),B?.ownerWalletAddress&&"N/A"!==B.ownerWalletAddress||a.push("Owner wallet missing"),I&&"Not connected"!==I||a.push("Network not connected"),K||a.push("Wrong network"),(!B?.totalPrice||B.totalPrice<=0)&&a.push("Invalid price"),null==F&&a.push("Balance not loaded"),null!==F&&B&&F<B.totalPrice+H&&a.push("Insufficient balance"),a.push("MetaMask not installed"),q.toast.error(`Please complete all required fields: ${a.join(", ")}`)}},disabled:x||!P,className:"w-full bg-teal-600 hover:bg-teal-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",size:"lg",type:"button",children:x?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):"Confirm reservation"})]})]})}),B&&(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(g.Card,{className:"p-6 shadow-xl sticky top-8",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("div",{className:"w-full h-48 bg-gradient-to-br from-teal-400 to-blue-500 rounded-lg mb-4 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white text-xl font-semibold",children:B.propertyTitle||"Property"})}),(0,b.jsx)("span",{className:"inline-block px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-xs font-medium",children:B.status||"PENDING"})]}),(0,b.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(m.Calendar,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Check-in"}),(0,b.jsx)("p",{className:"text-base text-gray-900",children:B.checkInDate?new Date(B.checkInDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(m.Calendar,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Check-out"}),(0,b.jsx)("p",{className:"text-base text-gray-900",children:B.checkOutDate?new Date(B.checkOutDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(n.User,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Guest"}),(0,b.jsx)("p",{className:"text-base text-gray-900",children:B.userFirstName&&B.userLastName?`${B.userFirstName} ${B.userLastName}`:B.userEmail||"N/A"})]})]})]}),(0,b.jsxs)("div",{className:"border-t pt-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Price details"}),(0,b.jsxs)("div",{className:"space-y-3",children:[T>0&&B.propertyPrice>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:[T," ",1===T?"night":"nights"," ×"," ",B.propertyPrice.toFixed(6)," ETH"]}),(0,b.jsxs)("span",{className:"text-gray-900",children:[(B.propertyPrice*T).toFixed(6)," ETH"]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-base font-semibold pt-3 border-t",children:[(0,b.jsx)("span",{className:"text-gray-900",children:"Total"}),(0,b.jsxs)("span",{className:"text-gray-900",children:[S.toFixed(6)," ETH"]})]})]})]})]})})]})})})}a.s(["default",()=>r],44451)}];

//# sourceMappingURL=app_payment_page_tsx_caeae9a0._.js.map