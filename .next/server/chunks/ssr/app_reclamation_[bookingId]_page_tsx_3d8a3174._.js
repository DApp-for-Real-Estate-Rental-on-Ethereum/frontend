module.exports=[82918,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(13216),f=a.i(72211),g=a.i(40695),h=a.i(3130),i=a.i(5522),j=a.i(17171),k=a.i(46893),l=a.i(96221),m=a.i(73570),n=a.i(33508),o=a.i(73320),p=a.i(16201),q=a.i(63519),r=a.i(24987),s=a.i(67900),t=a.i(41675),u=a.i(71987),v=a.i(54161);let w=[{value:"ACCESS_ISSUE",label:"Access Issue",description:"Cannot access the property, key/code doesn't work, host didn't respond..."},{value:"NOT_AS_DESCRIBED",label:"Property Not As Described",description:"Different number of rooms, location, property type, missing important amenities..."},{value:"CLEANLINESS",label:"Cleanliness Issue",description:"Dirty, strong odors, unclean bedding..."},{value:"SAFETY_HEALTH",label:"Safety or Health Hazard",description:"Gas leak, exposed wires, excessive pests..."}],x=[{value:"PROPERTY_DAMAGE",label:"Property Damage",description:"Broken furniture, appliances, glass, walls..."},{value:"EXTRA_CLEANING",label:"Excessive Dirt",description:"Requires deep cleaning (unusual condition after departure)"},{value:"HOUSE_RULE_VIOLATION",label:"House Rule Violation",description:"Parties, smoking prohibited, unauthorized pets..."},{value:"UNAUTHORIZED_GUESTS_OR_STAY",label:"Unauthorized Guests or Extended Stay",description:"Not authorized or staying longer than agreed without payment"}];function y(){let a=(0,d.useParams)(),y=(0,d.useSearchParams)(),z=(0,d.useRouter)(),{user:A,isLoading:B,isAuthenticated:C}=(0,e.useAuth)(),D=a?.bookingId,E=y?.get("isHost")==="true",F=y?.get("reclamationId"),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(null),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!B){if(!C||!A||!D)return void z.push("/login");ae()}},[A,D,z,B,C,F]);let ae=async()=>{if(A?.id&&D){ad(!0);try{let a=null;if(F)try{console.log("ðŸ” Fetching reclamation by ID:",F),a=await f.apiClient.reclamations.getById(parseInt(F)),console.log("âœ… Found reclamation by ID:",a)}catch(a){console.error("âŒ Failed to fetch reclamation by ID:",a)}if(!a)try{console.log("ðŸ” Fetching reclamation by bookingId and complainantId:",D,A.id),a=await f.apiClient.reclamations.getByBookingIdAndComplainant(D,A.id),console.log("âœ… Found reclamation by bookingId:",a)}catch(a){console.error("âŒ Failed to fetch reclamation by bookingId:",a)}if(a){X(a),V(!0);try{let b=await f.apiClient.bookings.getById(D);Z(b);let c=null;if(b?.propertyId)try{c=await f.apiClient.properties.getById(String(b.propertyId)),_(c)}catch(a){console.error("Failed to fetch property:",a)}try{let d=null;if(console.log("ðŸ“ž Reclamation data:",{complainantId:a.complainantId,targetUserId:a.targetUserId,complainantRole:a.complainantRole,currentUserId:A.id}),a.complainantId===A.id?(d=a.targetUserId,console.log("ðŸ“ž User is complainant, fetching target user phone. targetUserId:",d)):(d=a.complainantId,console.log("ðŸ“ž User is target, fetching complainant phone. complainantId:",d)),(!d||0===d)&&b){if(console.log("âš ï¸ targetUserId not available, trying fallback method"),"GUEST"===a.complainantRole)if(c?.userId)d=parseInt(String(c.userId));else{let a=await f.apiClient.bookings.getPropertyInfo(String(b.propertyId));a.ownerId&&(d=a.ownerId)}else d=b.userId;console.log("ðŸ“ž Fallback targetUserId:",d)}if(d&&d>0){console.log("ðŸ“ž Fetching user info for ID:",d);let a=await f.apiClient.users.getById(d);console.log("ðŸ“ž User info received:",a),a&&a.phoneNumber?(console.log("âœ… Setting phone number:",a.phoneNumber),ab(String(a.phoneNumber))):console.log("âš ï¸ No phone number found in user info")}else console.log("âš ï¸ Invalid targetUserId:",d)}catch(a){console.error("âŒ Failed to fetch phone number:",a)}}catch(a){console.error("Failed to fetch booking:",a)}}}catch(a){console.log("No existing reclamation found, staying in create mode")}finally{ad(!1)}}},af=async a=>{if(a.preventDefault(),!G)return void R("Please select a reclamation type");if(!I||!I.trim())return void R("Title is required");if(!K||!K.trim())return void R("Description is required");if(M.length>3)return void R("You can upload a maximum of 3 images");if(!A?.id||!D)return void R("User or booking information is missing");P(!0),R(null);try{let a=M.map(a=>a.file);await f.apiClient.reclamations.create(D,A.id,E?"HOST":"GUEST",G,I.trim(),K.trim(),a.length>0?a:void 0),T(!0),setTimeout(()=>{z.back()},2e3)}catch(a){R(a.message||"Failed to submit reclamation")}finally{P(!1)}};return B?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-teal-50 via-white to-cyan-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(l.Loader2,{className:"h-16 w-16 animate-spin text-teal-600 mx-auto mb-4"}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-8 h-8 bg-teal-100 rounded-full"})})]}),(0,b.jsx)("p",{className:"text-gray-600 font-medium text-lg",children:"Loading..."})]})}):C&&A&&D?U&&W?(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 py-12",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)(h.Card,{className:"p-8 shadow-2xl border-2 border-teal-100 bg-white/95 backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`p-3 rounded-xl ${E?"bg-orange-100":"bg-teal-100"}`,children:(0,b.jsx)(m.AlertTriangle,{className:`w-6 h-6 ${E?"text-orange-600":"text-teal-600"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent",children:"Reclamation Details"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"View your reclamation information"})]})]}),(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>z.back(),children:"Back"})]})}),ac?(0,b.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,b.jsx)(l.Loader2,{className:"w-8 h-8 animate-spin text-teal-600"}),(0,b.jsx)("p",{className:"ml-4 text-gray-600",children:"Loading details..."})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"p-6 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:W.title}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v.Badge,{className:"OPEN"===W.status?"bg-blue-100 text-blue-800":"IN_REVIEW"===W.status?"bg-yellow-100 text-yellow-800":"RESOLVED"===W.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:W.status.replace("_"," ")}),(0,b.jsx)(v.Badge,{className:"LOW"===W.severity?"bg-green-100 text-green-800":"MEDIUM"===W.severity?"bg-yellow-100 text-yellow-800":"HIGH"===W.severity?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800",children:W.severity})]})]}),(0,b.jsx)("p",{className:"text-gray-700 text-base leading-relaxed",children:W.description})]}),$&&(0,b.jsxs)("div",{className:"p-6 bg-teal-50 rounded-lg border-2 border-teal-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(s.Building2,{className:"w-5 h-5 text-teal-600"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Property Information"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:$.title}),$.address&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(r.MapPin,{className:"w-4 h-4 text-teal-600"}),(0,b.jsxs)("span",{children:[$.address.city,", ",$.address.country]})]})]})]}),Y&&(0,b.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg border-2 border-blue-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(t.Calendar,{className:"w-5 h-5 text-blue-600"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Booking Dates"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Check-in"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:new Date(Y.checkInDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Check-out"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:new Date(Y.checkOutDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]})]})]}),aa&&(0,b.jsxs)("div",{className:"p-6 bg-green-50 rounded-lg border-2 border-green-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(q.Phone,{className:"w-5 h-5 text-green-600"}),(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[W.complainantId===A.id?"GUEST"===W.complainantRole?"Host":"Tenant":"GUEST"===W.complainantRole?"Guest":"Host"," Phone Number"]})]}),(0,b.jsx)("p",{className:"text-xl font-bold text-gray-900",children:aa}),(0,b.jsxs)("a",{href:`tel:${aa}`,className:"mt-3 inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,b.jsx)(q.Phone,{className:"w-4 h-4"}),"Call Now"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Reclamation Type"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:W.type.replace(/_/g," ")})]}),(W.refundAmount||W.penaltyPoints)&&(0,b.jsxs)("div",{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border-2 border-purple-200",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Financial Details"}),(0,b.jsxs)("div",{className:"space-y-2",children:[W.refundAmount&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-gray-700",children:"Refund Amount:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",W.refundAmount.toFixed(2)]})]}),W.penaltyPoints&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-gray-700",children:"Penalty Points:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-red-600",children:[W.penaltyPoints," pts"]})]})]})]}),W.resolutionNotes&&(0,b.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg border-2 border-blue-200",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Resolution Notes"}),(0,b.jsx)("p",{className:"text-blue-700",children:W.resolutionNotes})]}),W.attachments&&W.attachments.length>0&&(0,b.jsxs)("div",{className:"p-6 bg-gray-50 rounded-lg",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attached Images"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-4",children:W.attachments.map((a,c)=>(0,b.jsx)("div",{className:"relative aspect-square rounded-lg overflow-hidden border-2 border-gray-200",children:(0,b.jsx)(u.default,{src:`http://localhost:8091${a.filePath}`,alt:`Attachment ${c+1}`,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 33vw, 200px"})},c))})]}),"OPEN"===W.status&&W.complainantId===A.id&&(0,b.jsx)("div",{className:"pt-6 border-t-2 border-gray-100",children:(0,b.jsx)(g.Button,{variant:"destructive",onClick:async()=>{if(window.confirm("Are you sure you want to delete this reclamation?"))try{await f.apiClient.reclamations.delete(W.id,A.id),z.back()}catch(a){R(a.message||"Failed to delete reclamation")}},children:"Delete Reclamation"})})]})]})})}):(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 py-12",children:(0,b.jsx)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)(h.Card,{className:"p-8 shadow-2xl border-2 border-teal-100 bg-white/95 backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:`p-3 rounded-xl ${E?"bg-orange-100":"bg-teal-100"}`,children:(0,b.jsx)(m.AlertTriangle,{className:`w-6 h-6 ${E?"text-orange-600":"text-teal-600"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent",children:E?"Host Reclamation":"Guest Reclamation"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:E?"Report issues with your property":"Report issues with your booking"})]})]})}),Q&&(0,b.jsx)("div",{className:"mb-6 p-4 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 rounded-xl shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,b.jsx)(m.AlertTriangle,{className:"w-5 h-5 text-red-600"})}),(0,b.jsx)("p",{className:"text-red-700 font-medium",children:Q})]})}),S&&(0,b.jsx)("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl shadow-lg animate-pulse",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,b.jsx)(p.CheckCircle,{className:"w-5 h-5 text-green-600"})}),(0,b.jsx)("p",{className:"text-green-700 font-medium",children:"Reclamation submitted successfully!"})]})}),(0,b.jsxs)("form",{onSubmit:af,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-base font-semibold text-gray-900 mb-4 block",children:"Reclamation Type *"}),(0,b.jsx)("div",{className:"space-y-3",children:(E?x:w).map(a=>(0,b.jsx)("label",{className:`block p-5 border-2 rounded-xl cursor-pointer transition-all duration-300 ${G===a.value?"border-teal-500 bg-gradient-to-r from-teal-50 to-cyan-50 shadow-lg transform scale-[1.02]":"border-gray-200 bg-white hover:border-teal-300 hover:shadow-md hover:bg-gray-50"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:`mt-1 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${G===a.value?"border-teal-500 bg-teal-500":"border-gray-300"}`,children:G===a.value&&(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})}),(0,b.jsx)("input",{type:"radio",name:"reclamationType",value:a.value,checked:G===a.value,onChange:a=>H(a.target.value),className:"hidden"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900 mb-1 text-lg",children:a.label}),(0,b.jsx)("div",{className:"text-sm text-gray-600 leading-relaxed",children:a.description})]})]})},a.value))})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(j.Label,{htmlFor:"title",className:"text-base font-semibold text-gray-900 mb-2 block",children:["Title ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(i.Input,{id:"title",type:"text",value:I,onChange:a=>J(a.target.value),placeholder:"Short title for the reclamation...",required:!0,className:"mt-2 border-2 border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 rounded-lg transition-all"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(j.Label,{htmlFor:"description",className:"text-base font-semibold text-gray-900 mb-2 block",children:["Description ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(k.Textarea,{id:"description",value:K,onChange:a=>L(a.target.value),rows:5,placeholder:"Add additional details about the reclamation...",required:!0,className:"mt-2 border-2 border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 rounded-lg transition-all resize-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"images",className:"text-base font-semibold text-gray-900 mb-2 block",children:"Images (Optional - Maximum 3 images)"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsxs)("label",{htmlFor:"images",className:`flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-xl cursor-pointer transition-all ${M.length>=3?"border-gray-300 bg-gray-50 cursor-not-allowed opacity-50":"border-teal-300 bg-teal-50/50 hover:bg-teal-50 hover:border-teal-400"}`,children:[(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,b.jsx)(o.Upload,{className:`w-8 h-8 mb-2 ${M.length>=3?"text-gray-400":"text-teal-600"}`}),(0,b.jsx)("p",{className:`text-sm font-medium ${M.length>=3?"text-gray-400":"text-teal-700"}`,children:M.length>=3?"Maximum images reached":"Click to upload images"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG up to 3 images"})]}),(0,b.jsx)(i.Input,{id:"images",type:"file",accept:"image/*",multiple:!0,onChange:a=>{let b=Array.from(a.target.files||[]);M.length+b.length>3?R("You can upload a maximum of 3 images"):N([...M,...b.map(a=>({file:a,preview:URL.createObjectURL(a)}))])},disabled:M.length>=3,className:"hidden"})]})}),M.length>0&&(0,b.jsx)("div",{className:"mt-4 grid grid-cols-3 gap-4",children:M.map((a,c)=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("div",{className:"relative aspect-square rounded-xl overflow-hidden border-2 border-gray-200 shadow-md hover:shadow-xl transition-all duration-300",children:(0,b.jsx)(u.default,{src:a.preview,alt:`Preview ${c+1}`,fill:!0,className:"object-cover group-hover:scale-110 transition-transform duration-300",sizes:"(max-width: 768px) 33vw, 150px"})}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a;return a=M.filter((a,b)=>b!==c),void(URL.revokeObjectURL(M[c].preview),N(a))},className:"absolute -top-2 -right-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-full p-1.5 hover:from-red-600 hover:to-red-700 transition-all shadow-lg hover:shadow-xl hover:scale-110",children:(0,b.jsx)(n.X,{className:"w-4 h-4"})})]},c))}),M.length>0&&(0,b.jsx)("div",{className:"mt-3 flex items-center justify-center",children:(0,b.jsx)("div",{className:"px-4 py-2 bg-teal-100 rounded-full",children:(0,b.jsxs)("p",{className:"text-sm font-semibold text-teal-700",children:[M.length," / 3 images"]})})})]}),(0,b.jsxs)("div",{className:"flex gap-4 pt-6 border-t-2 border-gray-100",children:[(0,b.jsx)(g.Button,{type:"submit",disabled:O||!G||!I.trim()||!K.trim(),className:"flex-1 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white font-semibold py-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:O?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"w-5 h-5 mr-2 animate-spin"}),"Submitting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Upload,{className:"w-5 h-5 mr-2"}),"Submit Reclamation"]})}),(0,b.jsx)(g.Button,{type:"button",onClick:()=>z.back(),variant:"outline",className:"flex-1 border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold py-6 rounded-xl hover:bg-gray-50 transition-all duration-300",children:"Cancel"})]})]})]})})}):null}a.s(["default",()=>y])}];

//# sourceMappingURL=app_reclamation_%5BbookingId%5D_page_tsx_3d8a3174._.js.map