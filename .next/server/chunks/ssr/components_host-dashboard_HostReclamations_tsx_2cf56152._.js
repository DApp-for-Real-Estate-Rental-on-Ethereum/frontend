module.exports=[30619,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(72211),e=a.i(3130),f=a.i(40695),g=a.i(54161),h=a.i(5522),i=a.i(46893),j=a.i(17171),k=a.i(65733),l=a.i(96221),m=a.i(73570),n=a.i(77156),o=a.i(81560),p=a.i(63519),q=a.i(24987),r=a.i(67900);let s=(0,a.i(70106).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var t=a.i(33508),u=a.i(73320),v=a.i(50944),w=a.i(23292);let x=process.env.NEXT_PUBLIC_RECLAMATION_API_BASE_URL||"http://localhost:8091";function y({ownerId:a,filter:y}){(0,v.useRouter)();let[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)({}),[H,I]=(0,c.useState)({}),[J,K]=(0,c.useState)({}),[L,M]=(0,c.useState)({}),[N,O]=(0,c.useState)({}),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1);(0,c.useEffect)(()=>{ad()},[a,y]);let ad=async()=>{C(!0),E("");try{let b=[];b="my-complaints"===y?await d.apiClient.reclamations.getMyComplaints(a):await d.apiClient.reclamations.getComplaintsAgainstMe(a),A(b||[]),b&&b.length>0&&await ae(b)}catch(a){E(a.message||"Failed to fetch reclamations"),w.toast.error("Failed to load reclamations")}finally{C(!1)}},ae=async a=>{try{let b={},c={};await Promise.all(a.map(async a=>{try{M(b=>({...b,[a.id]:!0}));try{let e=await d.apiClient.bookings.getById(a.bookingId);if(e&&e.propertyId){try{let c=await d.apiClient.properties.getById(String(e.propertyId));b[a.id]=c}catch(a){}if("complaints-against-me"===y)try{let b=await d.apiClient.reclamations.getUserPhoneNumber(a.complainantId);c[a.id]=b}catch(a){}}}catch(a){}}catch(a){}finally{M(b=>({...b,[a.id]:!1}))}})),I(a=>({...a,...b})),K(a=>({...a,...c}))}catch(a){}},af=async a=>{aa(!0);try{let b=await d.apiClient.reclamations.getAttachments(a);return O(c=>({...c,[a]:b||[]})),b||[]}catch(b){try{let b=await d.apiClient.adminReclamations.getAttachments(a);return O(c=>({...c,[a]:b||[]})),b||[]}catch(a){return[]}}finally{aa(!1)}},ag=async a=>{U(a),Q(!0),await af(a.id)},ah=async a=>{U(a),W(a.title),Y(a.description),$([]),S(!0),$((await af(a.id)||[]).map(b=>{let c=b.filePath;b.filePath.includes("/")&&(c=b.filePath.split("/").pop()||b.filePath),c=c.replace(/\\/g,"/").split("/").pop()||c;let d=`${x}/api/reclamations/files/${a.id}/${encodeURIComponent(c)}`;return console.log("ðŸ“¸ Edit dialog - Image URL:",d,"from filePath:",b.filePath),{preview:d,url:d}}))},ai=async()=>{if(T){if(!V.trim()||!X.trim())return void w.toast.error("Title and description are required");ac(!0);try{let b=Z.filter(a=>!a.file&&a.url).length,c=Z.filter(a=>a.file).map(a=>a.file);if(b+c.length>3){w.toast.error("Maximum 3 images allowed"),ac(!1);return}let e=c.length>0?c:void 0;await d.apiClient.reclamations.update(T.id,a,V.trim(),X.trim(),e),w.toast.success("Reclamation updated successfully"),S(!1),await ad()}catch(a){w.toast.error(a.message||"Failed to update reclamation")}finally{ac(!1)}}},aj=async b=>{if(window.confirm("Are you sure you want to remove this reclamation?")){G(a=>({...a,[b]:!0}));try{await d.apiClient.reclamations.delete(b,a),A(a=>a.filter(a=>a.id!==b)),w.toast.success("Reclamation removed successfully")}catch(a){w.toast.error(a.message||"Failed to remove reclamation")}finally{G(a=>({...a,[b]:!1}))}}};return B?(0,b.jsxs)(e.Card,{className:"p-12 text-center",children:[(0,b.jsx)(l.Loader2,{className:"w-8 h-8 animate-spin text-teal-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading reclamations..."})]}):D?(0,b.jsx)(e.Card,{className:"p-6 border-red-200 bg-red-50",children:(0,b.jsx)("p",{className:"text-red-700",children:D})}):0===z.length?(0,b.jsxs)(e.Card,{className:"p-12 text-center",children:[(0,b.jsx)(m.AlertTriangle,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"my-complaints"===y?"No complaints filed":"No complaints against you"}),(0,b.jsx)("p",{className:"text-gray-600",children:"my-complaints"===y?"You haven't filed any complaints yet.":"You don't have any complaints filed against you."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:z.map(a=>{var c,d,h;let i,j,k,m=H[a.id],t=J[a.id];return L[a.id],"my-complaints"===y&&console.log("ðŸ” Reclamation Debug:",{id:a.id,status:a.status,statusType:typeof a.status,filter:y,canEdit:"my-complaints"===y&&"OPEN"===a.status,statusCheck:"OPEN"===a.status,statusValue:JSON.stringify(a.status)}),(0,b.jsx)(e.Card,{className:"p-6 hover:shadow-lg transition-shadow",children:(0,b.jsxs)("div",{className:"flex flex-col h-full",children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2 flex-1",children:a.title})}),"my-complaints"===y&&(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(c=a.status,(0,b.jsx)(g.Badge,{className:{OPEN:"bg-blue-100 text-blue-800",IN_REVIEW:"bg-yellow-100 text-yellow-800",RESOLVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800"}[c]||"bg-gray-100 text-gray-800",children:c.replace("_"," ")})),(d=a.severity,(0,b.jsx)(g.Badge,{className:{LOW:"bg-green-100 text-green-800",MEDIUM:"bg-yellow-100 text-yellow-800",HIGH:"bg-orange-100 text-orange-800",CRITICAL:"bg-red-100 text-red-800"}[d]||"bg-gray-100 text-gray-800",children:d}))]})]}),(0,b.jsx)("p",{className:"text-gray-600 mb-4 text-sm line-clamp-3 flex-1",children:a.description}),"my-complaints"===y&&m&&(0,b.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(r.Building2,{className:"w-4 h-4 text-teal-600"}),(0,b.jsx)("span",{className:"font-semibold text-sm text-gray-900",children:m.title})]}),m.address&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[(0,b.jsx)(q.MapPin,{className:"w-3 h-3 text-teal-600"}),(0,b.jsxs)("span",{children:[m.address.city,", ",m.address.country]})]})]}),"complaints-against-me"===y&&t&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-teal-50 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(p.Phone,{className:"w-4 h-4 text-teal-600"}),(0,b.jsx)("span",{className:"text-gray-600",children:"Complainant Phone:"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:t})]})}),"my-complaints"===y&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"Type: "}),(0,b.jsx)("span",{className:"text-xs font-medium text-gray-700",children:{ACCESS_ISSUE:"Access Issue",NOT_AS_DESCRIBED:"Not As Described",CLEANLINESS:"Cleanliness",SAFETY_HEALTH:"Safety & Health",PROPERTY_DAMAGE:"Property Damage",EXTRA_CLEANING:"Extra Cleaning",HOUSE_RULE_VIOLATION:"House Rule Violation",UNAUTHORIZED_GUESTS_OR_STAY:"Unauthorized Guests/Stay"}[h=a.type]||h})]}),"my-complaints"===y&&(0,b.jsxs)("div",{className:"mb-4 space-y-1",children:[a.refundAmount&&(0,b.jsxs)("div",{className:"text-sm font-semibold text-green-600",children:["Refund: ",a.refundAmount.toFixed(2)," MAD"]}),a.penaltyPoints&&(0,b.jsxs)("div",{className:"text-sm font-semibold text-red-600",children:["Penalty: ",a.penaltyPoints," pts"]})]}),"my-complaints"===y&&a.resolutionNotes&&(0,b.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Resolution:"}),(0,b.jsx)("p",{className:"text-xs text-blue-700",children:a.resolutionNotes})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-auto pt-4 border-t border-gray-200",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>ag(a),children:[(0,b.jsx)(n.Eye,{className:"w-4 h-4 mr-1"}),"View"]}),(i="my-complaints"===y,"object"==typeof(j=a.status)&&null!==j&&(j=j.name||j.value||String(j)),k="OPEN"===(j=String(j||"").trim().toUpperCase()),(i&&console.log("ðŸ”§ Edit Button Logic:",{id:a.id,isMyComplaints:i,originalStatus:a.status,statusValue:j,isOpen:k,willShowEdit:i&&k}),i&&k)?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>ah(a),title:"Edit reclamation",children:[(0,b.jsx)(s,{className:"w-4 h-4 mr-1"}),"Edit"]}),(0,b.jsx)(f.Button,{variant:"destructive",size:"sm",onClick:()=>aj(a.id),disabled:F[a.id],children:F[a.id]?(0,b.jsx)(l.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(o.Trash2,{className:"w-4 h-4"})})]}):i?(0,b.jsxs)("div",{className:"text-xs text-gray-500 italic px-2 py-1 bg-gray-50 rounded",children:["Cannot edit (Status: ",j,")"]}):null)]})]})},a.id)})}),(0,b.jsx)(k.Dialog,{open:P,onOpenChange:Q,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Reclamation Details"}),(0,b.jsx)(k.DialogDescription,{children:"my-complaints"===y?"View your reclamation":"View reclamation against you"})]}),T&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-sm font-medium text-gray-700",children:"Title"}),(0,b.jsx)("p",{className:"text-sm text-gray-900 mt-1",children:T.title})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-sm font-medium text-gray-700",children:"Description"}),(0,b.jsx)("p",{className:"text-sm text-gray-900 whitespace-pre-wrap mt-1",children:T.description})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Attachments"}),_?(0,b.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,b.jsx)(l.Loader2,{className:"w-5 h-5 animate-spin text-gray-400"}),(0,b.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Loading images..."})]}):N[T.id]?.length>0?(0,b.jsx)("div",{className:"grid grid-cols-2 gap-4",children:N[T.id].map((a,c)=>{let d=a.filePath;a.filePath.includes("/")&&(d=a.filePath.split("/").pop()||a.filePath),d=d.replace(/\\/g,"/").split("/").pop()||d;let e=`${x}/api/reclamations/files/${T.id}/${encodeURIComponent(d)}`;return console.log("ðŸ–¼ï¸ Image URL:",e,"from filePath:",a.filePath,"filename:",d),(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("img",{src:e,alt:`Attachment ${c+1}`,className:"w-full h-48 object-cover rounded-lg border border-gray-200",onError:b=>{let c=b.target;console.error("âŒ Failed to load image:",e,"from filePath:",a.filePath);let f=`${x}/api/admin/reclamations/files/${T.id}/${encodeURIComponent(d)}`;c.src!==f?c.src=f:c.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect fill='%23ddd' width='100' height='100'/%3E%3Ctext fill='%23999' font-family='sans-serif' font-size='14' x='50%25' y='50%25' text-anchor='middle' dy='.3em'%3EImage not found%3C/text%3E%3C/svg%3E"},onLoad:()=>{console.log("âœ… Image loaded successfully:",e)}})},a.id||c)})}):(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No images attached"})]}),"complaints-against-me"===y&&J[T.id]&&(0,b.jsx)("div",{className:"p-3 bg-teal-50 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Phone,{className:"w-4 h-4 text-teal-600"}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Complainant Phone:"}),(0,b.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:J[T.id]})]})})]})]})}),(0,b.jsx)(k.Dialog,{open:R,onOpenChange:S,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Edit Reclamation"}),(0,b.jsx)(k.DialogDescription,{children:"Update title, description, and images. Only OPEN reclamations can be edited."})]}),T&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"edit-title",children:"Title *"}),(0,b.jsx)(h.Input,{id:"edit-title",value:V,onChange:a=>W(a.target.value),placeholder:"Enter reclamation title"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"edit-description",children:"Description *"}),(0,b.jsx)(i.Textarea,{id:"edit-description",value:X,onChange:a=>Y(a.target.value),placeholder:"Enter reclamation description",rows:5})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{children:"Images (Max 3)"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-2",children:[Z.map((a,c)=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("img",{src:a.preview,alt:`Preview ${c+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),(0,b.jsx)("button",{onClick:()=>{$(a=>a.filter((a,b)=>b!==c))},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(t.X,{className:"w-4 h-4"})})]},c)),Z.length<3&&(0,b.jsxs)("label",{className:"flex items-center justify-center h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-teal-500 transition-colors",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{let b=a.target.files;if(!b)return;let c=[];for(let a=0;a<b.length&&Z.length+c.length<3;a++){let c=b[a];if(c.type.startsWith("image/")){let a=new FileReader;a.onload=a=>{$(b=>[...b,{file:c,preview:a.target?.result}])},a.readAsDataURL(c)}}}}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(u.Upload,{className:"w-6 h-6 text-gray-400 mx-auto mb-1"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"Add Image"})]})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:ai,disabled:ab||!V.trim()||!X.trim(),className:"flex-1",children:ab?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):"Update"})]})]})]})})]})}a.s(["HostReclamations",()=>y],30619)}];

//# sourceMappingURL=components_host-dashboard_HostReclamations_tsx_2cf56152._.js.map